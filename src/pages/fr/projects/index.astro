---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import ProjectCard from '@/components/ProjectCard.astro';
import AdvancedProjectFilter from '@/components/AdvancedProjectFilter.astro';
import { t, getLocalizedPath } from '@/i18n/utils';

const locale = 'fr';

// Get projects for current locale
const allProjects = await getCollection('projects', ({ id }) => {
  return id.startsWith(`${locale}/`);
});

// Sort by date (newest first)
const projects = allProjects.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Get all unique tags for filtering
const allTags = projects.flatMap(p => p.data.tags);
---

<BaseLayout title={t(locale, 'nav.projects')} locale={locale}>
  <section class="py-16 md:py-24">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="mx-auto max-w-6xl space-y-12">
        <!-- Header -->
        <div class="text-center space-y-4 animate-fade-in-up">
          <h1 class="font-heading text-4xl font-bold tracking-tight sm:text-5xl">
            {t(locale, 'projects.title')}
          </h1>
          <p class="text-lg text-muted-foreground">
            {t(locale, 'projects.subtitle')}
          </p>
        </div>

        <!-- Advanced Filter -->
        {projects.length > 0 && (
          <AdvancedProjectFilter tags={allTags} locale={locale} projectCount={projects.length} />
        )}

        <!-- Projects Grid -->
        {projects.length > 0 ? (
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {projects.map((project, index) => (
              <div
                class="animate-fade-in-up"
                style={`animation-delay: ${(index + 1) * 0.1}s;`}
                data-project-card
                data-tags={project.data.tags.join(',')}
                data-title={project.data.title}
                data-date={project.data.date.toISOString()}
                data-featured={project.data.featured.toString()}
              >
                <ProjectCard
                  title={project.data.title}
                  description={project.data.description}
                  tags={project.data.tags}
                  href={getLocalizedPath(locale, `projects/${project.slug.replace(`${locale}/`, '')}`)}
                  locale={locale}
                />
              </div>
            ))}
          </div>
        ) : (
          <div class="text-center py-12">
            <p class="text-muted-foreground">Aucun projet pour le moment.</p>
          </div>
        )}
      </div>
    </div>
  </section>
</BaseLayout>
